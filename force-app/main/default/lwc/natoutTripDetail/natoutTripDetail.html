<template>
    <div class="slds-form c-container">
        <div if:true={userCanEdit} class="save-button">
            <lightning-button class="slds-m-top_small"
                variant="brand"
                name="save"
                label="Save"
                onclick={saveForm}>
            </lightning-button>
        </div>
        <div if:false={userCanEdit} style="text-align: center; font-weight: bold;">
            You are not authorized to make changes to this trip
        </div>
        
        <div if:true={showApprovalWarnings} style="background-color: white; margin: 2%">
            <div style="padding: 2%">
            Approval Warnings
            <ul class="slds-m-around_medium">
                <template for:each={approvalWarnings} for:item="warn">
                    <li key={warn.rowNum}>
                        {warn.text}
                    </li>
                </template>
            </ul>
            </div>
        </div>
        
        <div class="slds-form-element slds-form-element_stacked">
            <lightning-record-edit-form 
                record-id={recordId}
                object-api-name="National_Outings_Trip__c"
                onload={handleLoad}
                onsubmit={handleUpdate}
            >
                <lightning-messages>
                </lightning-messages>

                <label class="slds-form-element__label" for="tripName">
                    <abbr title="required" class="slds-required">*</abbr>
                    Submission Name
                    <c-tooltip
                        text="For internal reference, e.g., Mary's trip"
                    >
                    </c-tooltip>
                </label>
                <lightning-input-field
                    field-name="Name"
                    onchange={handleFieldChange}
                    data-field="Name"
                    data-id="tripName"
                    variant="label-hidden"
                    required
                    disabled={userIsReadOnly}
                >
                </lightning-input-field>

                <label class="slds-form-element__label" for="tripTitle">
                    <abbr title="required" class="slds-required">*</abbr>
                    Trip Title
                    <c-tooltip
                        text="For publications, e.g., Service in Arches National Park, Utah"
                    >
                    </c-tooltip>
                </label>
                <lightning-input-field
                    field-name="Title__c"
                    onchange={handleFieldChange}
                    data-field="Title__c"
                    data-id="tripTitle"
                    variant="label-hidden"
                    required
                    disabled={userIsReadOnly}
                    >
                </lightning-input-field>
                <lightning-accordion 
                    active-section-name={activeTripSections}
                    allow-multiple-sections-open
                    onsectiontoggle={handleTripSectionToggle}
                >
                    <lightning-accordion-section name="Approval Status" label="Approval Status">
                        <div if:true={userCanEdit}>
                            <lightning-combobox
                                label="Approval Status"
                                placeholder="Choose Status"
                                value={chosenStatus}
                                options={statusOptions}
                                onchange={handleStatusChange}
                                class="approvalStatus"
                            >
                            </lightning-combobox>
                        </div>
                        <div if:false={userCanEdit}>
                            <lightning-output-field field-name="Status__c">
                            </lightning-output-field>
                        </div>
                
                    </lightning-accordion-section>

                    <lightning-accordion-section name="General" label="General Information">
                        <div style="display: none">
                            <lightning-input-field
                                field-name="Subcommittee__c"
                                data-field="Subcommittee__c"
                            >
                            </lightning-input-field>
                            <lightning-input-field
                                field-name="Trip_Type__c"
                                data-field="Trip_Type__c"
                            >
                            </lightning-input-field>
                            <lightning-input-field
                                field-name="Status__c"
                                data-field="Status__c"
                            >
                            </lightning-input-field>
                        </div>
                        <template if:false={tripIsInternational}>
                            <lightning-combobox
                                label="Trip Type"
                                placeholder='Select a Trip Type'
                                value={chosenTripType}
                                options={tripTypeOptionList}
                                onchange={handleTripTypeChange}
                                required
                            >
                            </lightning-combobox>
                            <lightning-combobox
                                label="Subcommittee"
                                placeholder='Select a Subcommittee'
                                value={chosenSubcomm}
                                options={subcommOptionList}
                                onchange={handleSubcommChange}
                                required
                            >
                            </lightning-combobox>
                        </template>
                        <lightning-input-field
                            field-name="Start_Date__c"
                            onchange={handleFieldChange}
                            data-field="Start_Date__c"
                            required
                        >
                        </lightning-input-field>
                        <lightning-input-field
                            field-name="End_Date__c"
                            onchange={handleFieldChange}
                            data-field="End_Date__c"
                            required
                        >
                        </lightning-input-field>
                        <lightning-input-field
                            field-name="Participants__c"
                            onchange={handleFieldChange}
                            data-field="Participants__c"
                        >
                        </lightning-input-field>
                        <lightning-input-field
                            field-name="Planned_Staff__c"
                            onchange={handleFieldChange}
                            data-field="Planned_Staff__c"
                        >
                        </lightning-input-field>
                        <div class="slds-p-top_small">
                            <c-natout-trip-staff
                                record-id={recordId}
                                can-edit={userCanEdit}
                            >
                            </c-natout-trip-staff>
                        </div>
                    </lightning-accordion-section>

                    <lightning-accordion-section name="Copy" label="Trip Copy and Marketing">
                        <div style="margin-bottom: 10px;">
                            Here you will submit the short trip description that appears in our annual trip catalog. Our goal is to recycle content, when possible, 
                            to reduce the burden on leaders and staff and ensure consistent and high-quality content that sells. 
                            Please follow these instructions closely so that your submission is accurate and complete. 
                            Once the trip guide editor receives your submission, they will review and follow up, if necessary, 
                            with questions or to review significant edits. 
                            &nbsp;<a href="https://community.sierraclub.org/page/trip-copy-0" target="_blank">
                                Check out our trip copy guide
                            </a>&nbsp;
                            for handy writing tips, examples, and the trip copy archive.
                        </div>
                        <label class="slds-form-element__label" for="firstTimeRun">
                            First Time Run
                            <c-tooltip text="Is this the first time this trip has been run?">                                
                            </c-tooltip>
                        </label>
                        <lightning-input-field
                            field-name="First_Time_Run__c"
                            onchange={handleFieldChange}
                            data-field="First_Time_Run__c"
                            data-id="firstTimeRun"
                            variant="label-hidden"
                        >
                        </lightning-input-field>
                        <template if:false={tripRecord.First_Time_Run__c}>
                            <label class="slds-form-element__label" for="priorTripNo">
                                Prior Trip #
                                <c-tooltip text="Previous trip number, e.g., 20015A">                                
                                </c-tooltip>
                            </label>
                                <lightning-input-field
                                field-name="Prior_Trip__c"
                                onchange={handleFieldChange}
                                data-field="Prior_Trip__c"
                                data-id="priorTripNo"
                                variant="label-hidden"
                            >
                            </lightning-input-field>
                        </template>

                        <label class="slds-form-element__label" for="tripCopy">
                            Trip Copy
                            <c-tooltip
                                text="Trip copy (30 words max for service trips, 60 words for all others, including family service trips)"
                            >
                            </c-tooltip>
                        </label>
                        <lightning-input-field
                            field-name="Trip_Copy__c"
                            onchange={handleFieldChange}
                            data-id="tripCopy"
                            data-field="Trip_Copy__c"
                            disabled={repeatTrip}
                            variant="label-hidden"
                        >
                        </lightning-input-field>

                        <div class="slds-form-element__label" style="margin-bottom: 5px;" if:true={tripRecord.First_Time_Run__c}>
                            Number of words in Trip Copy: {wordCount}
                        </div>
                        <template if:false={tripRecord.First_Time_Run__c}>
                            <label class="slds-form-element__label" for="priorCopyChanges">
                                Prior Trip Copy Changes
                                <c-tooltip text="Do you need to make changes to the previous trip copy? If so, briefly describe these changes below. If not, you may leave this field blank and we will reuse the previous trip copy as-is.">
                                </c-tooltip>
                            </label>
                            <lightning-input-field
                                field-name="Prior_Trip_Copy_Changes__c"
                                onchange={handleFieldChange}
                                data-field="Prior_Trip_Copy_Changes__c"
                                data-id="priorCopyChanges"
                                variant="label-hidden"
                            >
                            </lightning-input-field>
                        </template>
                        <div style="clear: both">
                        <label class="slds-form-element__label" for="conservation">
                            Conservation Emphasis
                            <c-tooltip text="Describe the conservation emphasis for this trip and when this will be discussed on the trip.">                                
                            </c-tooltip>
                        </label>
                        <lightning-input-field
                            field-name="Conservation_Emphasis__c"
                            onchange={handleFieldChange}
                            data-field="Conservation_Emphasis__c"
                            data-id="conservation"
                            variant="label-hidden"
                        >
                        </lightning-input-field>
                        </div>
                        <lightning-input-field
                            field-name="Meals_Included__c"
                            onchange={handleFieldChange}
                            data-field="Meals_Included__c"
                        >
                        </lightning-input-field>
                        <template if:true={showBPRating}>
                            <lightning-input-field
                                field-name="Backpack_Rating__c"
                                onchange={handleFieldChange}
                                data-field="Backpack_Rating__c"
                            >
                            </lightning-input-field>
                        </template>
                        <template if:true={showMinAge}>
                            <lightning-input-field
                                field-name="Minimum_Age__c"
                                onchange={handleFieldChange}
                                data-field="Minimum_Age__c"
                            >
                            </lightning-input-field>
                        </template>
                        <label class="slds-form-element__label" for="groupType">                            
                            Specialty Trip Type
                            <c-tooltip text="Is this trip designed for a particular group of people? If so, please select this group from the following list so that it will appear in online searches for these terms. Otherwise, it will default to adults of all ages.">                                
                            </c-tooltip>
                        </label>
                        <lightning-input-field
                            field-name="Group_Type__c"
                            onchange={handleFieldChange}
                            data-field="Group_Type__c"
                            data-id="groupType"
                            variant="label-hidden"
                        >
                        </lightning-input-field>
                        <label class="slds-form-element__label" for="groupType">
                            <b>Secondary Activities: Please select up to 2</b>
                            <c-tooltip text="Does this trip include additional activities not conveyed by the trip type, e.g. a base camp trip that also includes an overnight kayak excursion? If so, please select these activities. This will ensure that your trip appears in search results for these terms on our website.">
                            </c-tooltip>
                            <div style="margin-top:4px; margin-bottom:4px; clear:both">
                                Select an item from the Available table on the left and use the right arrow to add it to the Chosen table on the right. To remove an item from the Selected table, select it and use the left arrow.
                            </div>
                            <div style="margin-top:4px; margin-bottom:4px; clear:both">
                                If your area is not listed, email tony.rango@sierraclub.org to have it added. This update will need to made before the trip can be submitted.
                            </div>
                        </label>
                        <lightning-input-field
                            field-name="Activity_Type__c"
                            onchange={handleFieldChange}
                            data-field="Activity_Type__c"
                            data-id="groupType"
                            variant="label-hidden"
                        >
                        </lightning-input-field>
                    </lightning-accordion-section>

                    <lightning-accordion-section name="Location" label="Location Details, Safety and Risk">
                        <template if:true={tripIsInternational}>
                            <lightning-input-field
                                field-name="Geographic_Area__c"
                                onchange={handleFieldChange}
                                data-field="Geographic_Area__c"
                            >
                            </lightning-input-field>
                        </template>
                        <template if:false={tripIsInternational}>
                            <div style="margin-top:4px; margin-bottom:4px; font-size:small; clear:both">
                                Select an item from the Available table on the left and use the right arrow to add it to the Chosen table on the right. To remove an item from the Selected table, select it and use the left arrow.
                            </div>
                            <lightning-dual-listbox
                                label="States: please select up to 3"
                                source-label="Available"
                                selected-label="Chosen"
                                options={stateListOptions}
                                value={chosenStates}
                                onchange={handleStatesChange}
                            >
                            </lightning-dual-listbox>

                            <lightning-input-field
                                field-name="Country__c"
                                onchange={handleFieldChange}
                                data-field="Country__c"
                            >
                            </lightning-input-field>

                            <div style="margin-top:10px; margin-bottom:4px; font-size:small; clear:both">
                                Select an item from the Available table on the left and use the right arrow to add it to the Chosen table on the right. To remove an item from the Selected table, select it and use the left arrow.
                            </div>

                            <label class="slds-form-element__label" style="font-weight:bold;" for="area">
                                Areas: Please select up to 3
                            </label>
                            <lightning-input-field
                                field-name="Area__c"
                                onchange={handleFieldChange}
                                data-field="Area__c"
                                data-id="area"
                                variant="label-hidden"
                            >
                            </lightning-input-field>
                        </template>

                        <div style="display:none">
                            <lightning-input-field
                                field-name="International_Countries__c"
                                data-field="International_Countries__c"
                            >
                            </lightning-input-field>
                            <lightning-input-field
                                field-name="States__c"
                                data-field="States__c"
                            >
                            </lightning-input-field>
                        </div>
                        <template if:true={tripIsInternational}>
                            <div style="margin-top:4px; margin-bottom:4px; font-size:small; clear:both">
                                Select an item from the Available table on the left and use the right arrow to add it to the Chosen table on the right. To remove an item from the Selected table, select it and use the left arrow.
                            </div>
                            <lightning-dual-listbox
                                label="Countries - You May Select Up to 3"
                                source-label="Available"
                                selected-label="Chosen"
                                options={countryListOptions}
                                value={chosenCountries}
                                onchange={handleCountriesChange}
                            >
                            </lightning-dual-listbox>
                        </template>

                        <div class="slds-grid">
                            <div class="location-div slds-col">
                                <lightning-button 
                                    class="slds-m-top_small"
                                    label="Map Location" 
                                    onclick={mapLocation}
                                >
                                </lightning-button>
                                <c-tooltip
                                    text="Use the map location tool to select the park or region that is the focus of your trip. If the trip takes place in harder-to-define area, such as a portion of the Missouri River, search for a landmark featured in the trip, such as the town of Arrow Rock, Missouri.">
                                </c-tooltip>

                                <lightning-input-field
                                    field-name="Latitude__c"
                                    onchange={handleFieldChange}
                                    data-field="Latitude__c"
                                >
                                </lightning-input-field>

                                <lightning-input-field
                                    field-name="Longitude__c"
                                    onchange={handleFieldChange}
                                    data-field="Longitude__c"
                                >
                                </lightning-input-field>
                            </div>
                            <div class="slds-col slds-p-top_x-small">
                                <template if:true={showMap}>
                                    <lightning-map 
                                        map-markers={mapMarkers}
                                        zoom-level="7"
                                    >
                                    </lightning-map>
                                </template>
                            </div>
                        </div>
                        <template if:true={searchingForLocation}>
                            <c-location-finder
                                onlocationselected = {setLocation}
                                oncancellocation = {cancelLocation}
                                lat-lng = {latLng}
                            >
                            </c-location-finder>
                        </template>
                        <label class="slds-form-element__label" for="leaderDriving">
                            Leader Driving Participants During Trip?
                            <c-tooltip text="If the leader will be driving participants during the trip, they will also need to complete a Driver Policy and Declarations/Transportation Declaration, below. See the form for submission instructions.">                                
                            </c-tooltip>
                        </label>
                        <lightning-input-field
                            field-name="Leader_Driving_Participants_During_Trip__c"
                            onchange={handleFieldChange}
                            data-field="Leader_Driving_Participants_During_Trip__c"
                            data-id="leaderDriving"
                            variant="label-hidden"
                        >
                        </lightning-input-field>
                        <div class="slds-form-element__label">
                            Driver Policy and Declarations/Transportation Declaration Document (
                            <a href="https://community.sierraclub.org/file/3090/download/" target="_blank">Word</a>
                            |
                            <a href="https://community.sierraclub.org/file/3092/download/" target="_blank">PDF</a>)
                        </div>
                        <div style="clear: both;">
                        <label class="slds-form-element__label" for="risksHazards">
                            Risks/Hazards
                            <c-tooltip text="1) List major risks and hazards associated with this trip. 2) What strategies will you use to mitigate them? 3) What options for communications in field are available? 4) Name any dangerous wildlife in the trip area you may encounter. 5) Are you familiar with the protocols for this dangerous wildlife?">                                
                            </c-tooltip>
                        </label>
                        <lightning-input-field
                            field-name="Risks_Hazards__c"
                            onchange={handleFieldChange}
                            data-field="Risks_Hazards__c"
                            data-id="risksHazards"
                            variant="label-hidden"
                        >
                        </lightning-input-field>
                        </div>
                    </lightning-accordion-section>

                    <lightning-accordion-section name="Budget" label="Budget">
                        <lightning-accordion
                            allow-multiple-sections-open
                            active-section-name={activeBudgetSections}
                            onsectiontoggle={handleBudgetSectionToggle}
                        >
                        See this table [URL] for the standard values used in various budget categories below.
                        <lightning-accordion-section name="budget-vol-travel" label="Volunteer Travel">                                
                                <div class="slds-p-top_small">
                                    <c-natout-trip-budget-vol-travel
                                        record-id={recordId}
                                        staff-role-options={staffRoleOptions}
                                        can-edit={userCanEdit}
                                    >
                                    </c-natout-trip-budget-vol-travel>
                                </div>
                            </lightning-accordion-section>

                            <lightning-accordion-section name="Meals" label="Meals">
                                <div style="display: none">
                                    <lightning-input-field
                                        field-name="Meals_Budget_Option__c"
                                        data-field="Meals_Budget_Option__c"
                                    >
                                    </lightning-input-field>
                                </div>
                                <lightning-layout horizontal-align="center">
                                    <lightning-radio-group
                                        label="Meal Options"
                                        options={mealsBudgetOptions}
                                        value={selectedMealsBudgetOption}
                                        type="radio"
                                        onchange={handleFieldChange}
                                        data-field="Meals_Budget_Option__c"
                                    >
                                    </lightning-radio-group>
                                </lightning-layout>
                                <lightning-input-field
                                    field-name="Meals_Comments__c"
                                    onchange={handleFieldChange}
                                    data-field="Meals_Comments__c"
                                >
                                </lightning-input-field>
                                <template if:true={mealsBudgetSubcomm}>
                                    <lightning-input-field
                                        field-name="Meals_First_Day__c"
                                        onchange={handleFieldChange}
                                        data-field="Meals_First_Day__c"
                                    >
                                    </lightning-input-field>
                                    <lightning-input-field
                                        field-name="Meals_Last_Day__c"
                                        onchange={handleFieldChange}
                                        data-field="Meals_Last_Day__c"
                                    >
                                    </lightning-input-field>
                                </template>                     
                                <template if:true={mealsBudgetDay}>
                                    <div class="slds-p-top_small">
                                        <c-natout-trip-budget-meals
                                            record-id={recordId}
                                            trip-start-date={tripStartDate}
                                            trip-end-date={tripEndDate}
                                            num-staff={numStaff}
                                            can-edit={userCanEdit}
                                            >
                                        </c-natout-trip-budget-meals>
                                    </div>
                                </template>
                                <template if:false={mealsBudgetNone}>
                                    <lightning-input-field
                                        field-name="Fixed_Amount__c"
                                        onchange={handleFieldChange}
                                        data-field="Fixed_Amount__c"
                                    >
                                    </lightning-input-field>
                                </template>
                            </lightning-accordion-section>

                            <lightning-accordion-section name="budget-transportation" label="On Trip Transportation">                                
                                <lightning-input-field
                                    field-name="Transportation_Comments__c"
                                    onchange={handleFieldChange}
                                    data-field="Transportation_Comments__c"
                                >
                                </lightning-input-field>
                           <div class="slds-p-top_small">
                                    <c-natout-trip-budget-transportation
                                        record-id={recordId}
                                        can-edit={userCanEdit}
                                    >
                                    </c-natout-trip-budget-transportation>
                                </div>
                            </lightning-accordion-section>

                            <lightning-accordion-section name="budget-concessionaire" label={concessionaireTitle}>                                
                                <lightning-input-field
                                    field-name="Concessionaire_Comments__c"
                                    onchange={handleFieldChange}
                                    data-field="Concessionaire_Comments__c"
                                >
                                </lightning-input-field>
                                <div class="slds-p-top_small">
                                    <c-natout-trip-budget-concessionaire
                                        record-id={recordId}
                                        trip-is-international={tripIsInternational}
                                        num-staff={numStaff}
                                        can-edit={userCanEdit}
                                    >
                                    </c-natout-trip-budget-concessionaire>
                                </div>
                            </lightning-accordion-section>

                            <lightning-accordion-section name="budget-other" label="Other">                                
                                <div class="slds-p-top_small">
                                    <template if:false={tripIsInternational}>
                                        <lightning-input-field
                                            field-name="Wilderness_Agency_Fees__c"
                                            onchange={handleFieldChange}
                                            data-field="Wilderness_Agency_Fees__c"
                                        >
                                        </lightning-input-field>
                                        <lightning-input-field
                                            field-name="Commercial_Agency_Fees__c"
                                            onchange={handleFieldChange}
                                            data-field="Commercial_Agency_Fees__c"
                                        >
                                        </lightning-input-field>
                                    </template>
                                    <lightning-input-field
                                        field-name="Postage__c"
                                        onchange={handleFieldChange}
                                        data-field="Postage__c"
                                    >
                                    </lightning-input-field>
                                    <lightning-input-field
                                        field-name="Communication_Devices__c"
                                        onchange={handleFieldChange}
                                        data-field="Communication_Devices__c"
                                    >
                                    </lightning-input-field>
                                    <lightning-input-field
                                        field-name="Shipping__c"
                                        onchange={handleFieldChange}
                                        data-field="Shipping__c"
                                    >
                                    </lightning-input-field>
                                    <lightning-input-field
                                        field-name="Supplies_Equipment__c"
                                        onchange={handleFieldChange}
                                        data-field="Supplies_Equipment__c"
                                    >
                                    </lightning-input-field>
                                    <lightning-input-field
                                        field-name="General_Budget_Comments__c"
                                        onchange={handleFieldChange}
                                        data-field="General_Budget_Comments__c"
                                    >
                                    </lightning-input-field>
                                </div>
                            </lightning-accordion-section>
                                <lightning-accordion-section name="budget-report" label="Budget Report">
                                    <div>
                                        The trip price is an estimate based upon the values you entered and a standard overhead allocation. Your final price will be determined once processed by the office.
                                    </div>
                                    <iframe src={budgetReportUrl} width="100%" height="800px">
                                    </iframe>
                                </lightning-accordion-section>
                        </lightning-accordion>

                    </lightning-accordion-section>
                    
                    <template if:false={tripIsInternational}>
                        <div style="display:none">
                            <lightning-input-field
                                field-name="Permit_Requirement_Options__c"
                                data-field="Permit_Requirement_Options__c"
                            >
                            </lightning-input-field>
                        </div>
                        <lightning-accordion-section name="Permits" label="Permits">
                            <div>
                                For more information on Permits, see the 
                                &nbsp;<a href="https://community.sierraclub.org/section/outings/national-outings/permits" target="_blank">Permits</a>&nbsp;
                                section on Campfire.
                            </div>
                            <lightning-layout horizontal-align="center">
                                <lightning-radio-group
                                    label="Permit Requirement Options"
                                    options={permitRequirementOptions}
                                    value={selectedPermitRequirementOption}
                                    type="radio"
                                    onchange={handleFieldChange}
                                    data-field="Permit_Requirement_Options__c"
                                >
                                </lightning-radio-group>
                            </lightning-layout>
                            <lightning-input-field
                                field-name="Entry_Trail_Head__c"
                                onchange={handleFieldChange}
                                data-field="Entry_Trail_Head__c"
                            >
                            </lightning-input-field>
                            <lightning-input-field
                                field-name="Exit_Trail_Head__c"
                                onchange={handleFieldChange}
                                data-field="Exit_Trail_Head__c"
                            >
                            </lightning-input-field>
                            <lightning-input-field
                                field-name="Permit_Comments__c"
                                onchange={handleFieldChange}
                                data-field="Permit_Comments__c"
                            >
                            </lightning-input-field>
                            <div class="slds-p-top_small">
                                <c-natout-trip-agencies
                                    record-id={recordId}
                                    can-edit={userCanEdit}
                                    >
                                </c-natout-trip-agencies>
                            </div>
                        </lightning-accordion-section>
                    </template>

                    <lightning-accordion-section name="Itinerary" label="Itinerary">
                        <div class="slds-p-top_small">
                            <c-natout-trip-itinerary
                                record-id={recordId}
                                trip-start-date={tripStartDate}
                                trip-end-date={tripEndDate}
                                agency-options={agencyOptions}
                                can-edit={userCanEdit}
                            >
                            </c-natout-trip-itinerary>
                        </div>
                    </lightning-accordion-section>

                    <lightning-accordion-section name="Vendors" label="Vendors">
                        <lightning-input-field
                            field-name="Vendor_Comments__c"
                            onchange={handleFieldChange}
                            data-field="Vendor_Comments__c"
                        >
                        </lightning-input-field>
                        <div class="slds-p-top_small">
                            <c-natout-trip-vendors
                                record-id={recordId}
                                trip-is-international={tripIsInternational}
                                can-edit={userCanEdit}
                            >
                            </c-natout-trip-vendors>
                        </div>
                    </lightning-accordion-section>

                    <lightning-accordion-section name="SatPhone" label="Sat Phone">
                        <label class="slds-form-element__label" for="satPhoneNeeded">
                            SAT Phone Needed?
                            <c-tooltip text="Is a SAT phone needed?">                                
                            </c-tooltip>
                        </label>
                        <lightning-input-field
                            field-name="Sat_Phone_Needed__c"
                            onchange={handleFieldChange}
                            data-field="Sat_Phone_Needed__c"
                            data-id="satPhoneNeeded"
                            variant="label-hidden"
                        >
                        </lightning-input-field>
                        <template if:true={satPhoneNeeded}>
                            <label for="dateNeeded">
                                Date Needed
                            </label>
                            <lightning-input-field
                                field-name="Sat_Phone_Needed_Date__c"
                                onchange={handleFieldChange}
                                data-field="Sat_Phone_Needed_Date__c"
                                data-id="dateNeeded"
                                variant="label-hidden"
                            >
                            </lightning-input-field>
                            <div class="slds-p-top_small slds-p-bottom_small">
                                <strong>Ship To:</strong>
                            </div>
                            <label for="shipToName">
                                Name
                            </label>
                            <lightning-input-field
                                field-name="Sat_Phone_Ship_To_Name__c"
                                onchange={handleFieldChange}
                                data-field="Sat_Phone_Ship_To_Name__c"
                                data-id="shipToName"
                                variant="label-hidden"
                            >
                            </lightning-input-field>
                            <label for="shipToAddress">
                                Address
                            </label>
                            <lightning-input-field
                                field-name="Sat_Phone_Ship_To_Address__c"
                                onchange={handleFieldChange}
                                data-field="Sat_Phone_Ship_To_Address__c"
                                data-id="shipToAddress"
                                variant="label-hidden"
                            >
                            </lightning-input-field>
                            <label for="shipToCity">
                                City
                            </label>
                            <lightning-input-field
                                field-name="Sat_Phone_Ship_To_City__c"
                                onchange={handleFieldChange}
                                data-field="Sat_Phone_Ship_To_City__c"
                                data-id="shipToCity"
                                variant="label-hidden"
                            >
                            </lightning-input-field>
                            <label for="shipToState">
                                State
                            </label>
                            <lightning-input-field
                                field-name="Sat_Phone_Ship_To_State__c"
                                onchange={handleFieldChange}
                                data-field="Sat_Phone_Ship_To_State__c"
                                data-id="shipToState"
                                variant="label-hidden"
                            >
                            </lightning-input-field>
                            <label for="shipToZip">
                                Zip Code
                            </label>
                            <lightning-input-field
                                field-name="Sat_Phone_Ship_To_Zip_Code__c"
                                onchange={handleFieldChange}
                                data-field="Sat_Phone_Ship_To_Zip_Code__c"
                                data-id="shipToZip"
                                variant="label-hidden"
                            >
                            </lightning-input-field>
                        </template>
                    </lightning-accordion-section>

                    <lightning-accordion-section name="Collaborators" label="Collaborators">
                        <div>
                            Please enter the name, role, and access level of any active National Outings committee member who is 
                            working with you on this trip submission. This could be a home school mentor, trip submission reviewer, 
                            subcommittee chair, or someone else.
                        </div>
                        <c-natout-trip-collaborators
                            record-id={recordId}
                            can-edit={userCanEdit}
                            can-approve={userCanApprove}
                        >
                        </c-natout-trip-collaborators>
                    </lightning-accordion-section>

                    <lightning-accordion-section name="Comments" label="Comments">
                        <c-natout-trip-comments  
                            record-id={recordId}
                            can-edit={userCanEdit}
                        >
                        </c-natout-trip-comments>
                    </lightning-accordion-section>
            
                </lightning-accordion>
                <div if:true={userCanEdit} class="save-button">
                    <lightning-button class="slds-m-top_small"
                        variant="brand"
                        name="save"
                        label="Save"
                        onclick={saveForm}>
                    </lightning-button>
                </div>
            </lightning-record-edit-form>
        </div>
    </div>

    <template if:true={showStatusDialog}>
        <div>
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeErrorDisplay}>
                            <lightning-icon icon-name="utility:close" size="medium">
                            </lightning-icon>
                            <span class="slds-assistive-text">Close</span>
                        </button>
                        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Submit For Approval</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <template if:true={statusChangeErrors}>
                            The following errors prevent submission for approval:
                            <ul class="slds-m-around_medium">
                                <template for:each={errorList} for:item="err">
                                    <li key={err.rowNum}>
                                        {err.text}
                                    </li>
                                </template>
                            </ul>
                        </template>                
                        <template if:false={statusChangeErrors}>
                            <p>
                                The trip is ready to be submitted for approval.
                            </p>
                            <p>
                                Note that after saving the trip for with this status, you will no longer be 
                                able to make further changes unless the approver returns it to you.
                            </p>
                        </template>
                        </div>
                    <footer class="slds-modal__footer">
                        <lightning-button label="Dismiss" variant="neutral" onclick={closeErrorDisplay}></lightning-button>&nbsp;&nbsp;&nbsp;&nbsp;
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </div>
    </template>

    <c-snackbar></c-snackbar>
</template>